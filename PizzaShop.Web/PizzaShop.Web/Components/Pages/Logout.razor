@page "/logout"
@attribute [StreamRendering]
@attribute [Authorize]
@inject NavigationManager Navigation
@using System.Diagnostics

<PageTitle>Logging out...</PageTitle>

<div class="min-h-[60vh] flex items-center justify-center bg-[#7f2615] text-[#fef3c7] px-6">
  <div class="max-w-xl text-center space-y-3">
    <h1 class="text-3xl md:text-4xl font-extrabold tracking-wide">
      Tucking your Merry Crustmas session in for the night…
    </h1>
    <p class="text-lg md:text-xl leading-relaxed">
      We’re clearing the crumbs and hanging up your apron.
      In a moment you’ll be back at the front door, ready for another cozy visit.
    </p>
  </div>
</div>

@code {
  private static readonly ActivitySource ActivitySource = new("PizzaShop.Web.Auth");

  protected override async Task OnInitializedAsync()
  {
    using (ActivitySource.StartActivity("Auth.StartLogoutRedirect"))
    {
      // Allow the initial render to show the message, then wait a moment before redirect.
      await Task.Delay(TimeSpan.FromSeconds(1));

      var encodedReturnUrl = Uri.EscapeDataString("/");
      Navigation.NavigateTo($"/authentication/logout?returnUrl={encodedReturnUrl}", forceLoad: true);
    }
  }
}